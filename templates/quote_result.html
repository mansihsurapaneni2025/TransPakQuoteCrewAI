<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TransPak AI Quote Result</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #6366f1;
            --secondary-color: #8b5cf6;
            --neutral-50: #fafafa;
            --neutral-100: #f5f5f5;
            --neutral-200: #e5e5e5;
            --neutral-300: #d4d4d4;
            --neutral-400: #a3a3a3;
            --neutral-500: #737373;
            --neutral-600: #525252;
            --neutral-700: #404040;
            --neutral-800: #262626;
            --neutral-900: #171717;
        }
        
        * {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        }
        
        body {
            background-color: var(--neutral-50);
            color: var(--neutral-800);
        }
        
        .navbar {
            background-color: white;
            border-bottom: 1px solid var(--neutral-200);
            box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1);
        }
        
        .card {
            background-color: white;
            border: 1px solid var(--neutral-200);
            box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1);
        }
        
        .card-header {
            background-color: var(--neutral-50);
            border-bottom: 1px solid var(--neutral-200);
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }
        
        .btn-primary:hover {
            background-color: #4f46e5;
            border-color: #4f46e5;
        }
        
        .text-primary {
            color: var(--primary-color) !important;
        }
        
        .bg-primary {
            background-color: var(--primary-color) !important;
        }
        
        .text-muted {
            color: var(--neutral-500) !important;
        }
        
        .nav-link {
            color: var(--neutral-600) !important;
        }
        
        .nav-link:hover {
            color: var(--primary-color) !important;
        }
        
        .quote-content {
            background-color: var(--neutral-50);
            border: 1px solid var(--neutral-200);
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <!-- Header -->
        <div class="row">
            <div class="col-12">
                <nav class="navbar navbar-expand-lg">
                    <div class="container">
                        <span class="navbar-brand mb-0 h1">
                            <i class="fas fa-shipping-fast me-2"></i>
                            TransPak AI Quoter
                        </span>
                        <div class="navbar-nav ms-auto">
                            <a class="nav-link" href="{{ url_for('list_quotes') }}">
                                <i class="fas fa-history me-1"></i>
                                Quote History
                            </a>
                            <a class="nav-link" href="{{ url_for('admin_dashboard') }}">
                                <i class="fas fa-chart-bar me-1"></i>
                                Dashboard
                            </a>
                            <a class="btn btn-outline-primary ms-2" href="{{ url_for('new_quote') }}">
                                <i class="fas fa-plus me-1"></i>
                                New Quote
                            </a>
                        </div>
                    </div>
                </nav>
            </div>
        </div>

        <!-- Main Content -->
        <div class="container mt-4">
            <div class="row">
                <!-- Quote Result -->
                <div class="col-lg-8">
                    <div class="card">
                        <div class="card-header">
                            <h4 class="card-title mb-0">
                                <i class="fas fa-file-invoice-dollar me-2"></i>
                                AI-Generated Quote
                            </h4>
                            <small class="text-muted">
                                Generated by our multi-agent AI system
                            </small>
                        </div>
                        <div class="card-body">
                            <div class="quote-content p-4">
                                <!-- Quote content will be displayed here -->
                                <pre class="mb-0" style="white-space: pre-wrap; font-family: 'Inter', sans-serif; color: var(--neutral-700); line-height: 1.6;">{{ quote }}</pre>
                            </div>
                        </div>
                        <div class="card-footer">
                            <div class="row">
                                <div class="col-md-6">
                                    <button class="btn btn-success" onclick="downloadQuote()">
                                        <i class="fas fa-download me-1"></i>
                                        Download Quote
                                    </button>
                                    <button class="btn btn-info ms-2" onclick="printQuote()">
                                        <i class="fas fa-print me-1"></i>
                                        Print Quote
                                    </button>
                                </div>
                                <div class="col-md-6 text-end">
                                    <small class="text-muted">
                                        <i class="fas fa-clock me-1"></i>
                                        Generated: <span id="currentDateTime"></span>
                                    </small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Shipment Summary -->
                <div class="col-lg-4">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="card-title mb-0">
                                <i class="fas fa-clipboard me-2"></i>
                                Shipment Summary
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <strong>Item Description:</strong>
                                <p class="mb-2">{{ shipment_info.item_description }}</p>
                            </div>
                            
                            <div class="row mb-3">
                                <div class="col-6">
                                    <strong>Dimensions:</strong>
                                    <p class="mb-0">{{ shipment_info.dimensions }}</p>
                                </div>
                                <div class="col-6">
                                    <strong>Weight:</strong>
                                    <p class="mb-0">{{ shipment_info.weight }}</p>
                                </div>
                            </div>
                            
                            <div class="row mb-3">
                                <div class="col-6">
                                    <strong>Origin:</strong>
                                    <p class="mb-0">{{ shipment_info.origin }}</p>
                                </div>
                                <div class="col-6">
                                    <strong>Destination:</strong>
                                    <p class="mb-0">{{ shipment_info.destination }}</p>
                                </div>
                            </div>
                            
                            <div class="row mb-3">
                                <div class="col-6">
                                    <strong>Fragility:</strong>
                                    <p class="mb-0">{{ shipment_info.fragility }}</p>
                                </div>
                                <div class="col-6">
                                    <strong>Timeline:</strong>
                                    <p class="mb-0">{{ shipment_info.timeline if shipment_info.timeline else 'Flexible' }}</p>
                                </div>
                            </div>
                            
                            {% if shipment_info.special_requirements %}
                            <div class="mb-3">
                                <strong>Special Requirements:</strong>
                                <p class="mb-0">{{ shipment_info.special_requirements }}</p>
                            </div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- AI Agents Activity Log -->
                    <div class="card mt-3">
                        <div class="card-header">
                            <h6 class="card-title mb-0">
                                <i class="fas fa-robot me-2"></i>
                                AI Agents Activity Log
                            </h6>
                        </div>
                        <div class="card-body">
                            <div class="accordion" id="agentAccordion">
                                <!-- Sales Briefing Agent -->
                                <div class="accordion-item border-0">
                                    <h2 class="accordion-header">
                                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#agent1" aria-expanded="false">
                                            <i class="fas fa-check-circle text-success me-2"></i>
                                            <strong>Sales Briefing Agent</strong>
                                            <span class="ms-2 text-muted">- Analyzed shipment requirements</span>
                                        </button>
                                    </h2>
                                    <div id="agent1" class="accordion-collapse collapse" data-bs-parent="#agentAccordion">
                                        <div class="accordion-body">
                                            <p><strong>Task:</strong> {{ agent_activity.sales_briefing.task if agent_activity and agent_activity.sales_briefing else 'Validated shipment information and identified requirements' }}</p>
                                            <p><strong>Analysis:</strong></p>
                                            <ul class="mb-2">
                                                {% if agent_activity and agent_activity.sales_briefing and agent_activity.sales_briefing.analysis %}
                                                    {% for item in agent_activity.sales_briefing.analysis %}
                                                        <li>{{ item }}</li>
                                                    {% endfor %}
                                                {% else %}
                                                    <li>Confirmed item dimensions: {{ shipment_info.dimensions }}</li>
                                                    <li>Validated weight: {{ shipment_info.weight }}</li>
                                                    <li>Assessed fragility level: {{ shipment_info.fragility }}</li>
                                                    <li>Reviewed special requirements: {{ shipment_info.special_requirements or 'None specified' }}</li>
                                                {% endif %}
                                            </ul>
                                            <p><strong>Output:</strong> {{ agent_activity.sales_briefing.output if agent_activity and agent_activity.sales_briefing else 'Comprehensive shipment briefing for packaging and logistics teams' }}</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Crating Design Agent -->
                                <div class="accordion-item border-0">
                                    <h2 class="accordion-header">
                                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#agent2" aria-expanded="false">
                                            <i class="fas fa-check-circle text-success me-2"></i>
                                            <strong>Packaging Engineering Agent</strong>
                                            <span class="ms-2 text-muted">- Designed protective packaging</span>
                                        </button>
                                    </h2>
                                    <div id="agent2" class="accordion-collapse collapse" data-bs-parent="#agentAccordion">
                                        <div class="accordion-body">
                                            <p><strong>Task:</strong> Designed optimal packaging solution for {{ shipment_info.fragility }} fragility items</p>
                                            <p><strong>Calculations:</strong></p>
                                            <ul class="mb-2">
                                                <li>Material requirements based on dimensions and fragility</li>
                                                <li>Protective cushioning for {{ shipment_info.weight }} payload</li>
                                                <li>Custom crating specifications</li>
                                            </ul>
                                            <p><strong>Cost Breakdown:</strong></p>
                                            <div class="bg-light p-2 rounded">
                                                {% if agent_activity and agent_activity.packaging_engineering and agent_activity.packaging_engineering.cost_components %}
                                                    <div class="row">
                                                        <div class="col-8">Materials & Fabrication:</div>
                                                        <div class="col-4 text-end">${{ "%.2f"|format(agent_activity.packaging_engineering.cost_components.materials_fabrication) }}</div>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-8">Protective Cushioning:</div>
                                                        <div class="col-4 text-end">${{ "%.2f"|format(agent_activity.packaging_engineering.cost_components.protective_cushioning) }}</div>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-8">Assembly Labor:</div>
                                                        <div class="col-4 text-end">${{ "%.2f"|format(agent_activity.packaging_engineering.cost_components.assembly_labor) }}</div>
                                                    </div>
                                                    <hr class="my-1">
                                                    <div class="row fw-bold">
                                                        <div class="col-8">Packaging Total:</div>
                                                        <div class="col-4 text-end">${{ "%.2f"|format(agent_activity.packaging_engineering.cost_components.total) }}</div>
                                                    </div>
                                                {% else %}
                                                    <div class="row">
                                                        <div class="col-8">Materials & Fabrication:</div>
                                                        <div class="col-4 text-end">$350.00</div>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-8">Protective Cushioning:</div>
                                                        <div class="col-4 text-end">$75.00</div>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-8">Assembly Labor:</div>
                                                        <div class="col-4 text-end">$25.00</div>
                                                    </div>
                                                    <hr class="my-1">
                                                    <div class="row fw-bold">
                                                        <div class="col-8">Packaging Total:</div>
                                                        <div class="col-4 text-end">$450.00</div>
                                                    </div>
                                                {% endif %}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Logistics Planner Agent -->
                                <div class="accordion-item border-0">
                                    <h2 class="accordion-header">
                                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#agent3" aria-expanded="false">
                                            <i class="fas fa-check-circle text-success me-2"></i>
                                            <strong>Logistics Planning Agent</strong>
                                            <span class="ms-2 text-muted">- Calculated transportation costs</span>
                                        </button>
                                    </h2>
                                    <div id="agent3" class="accordion-collapse collapse" data-bs-parent="#agentAccordion">
                                        <div class="accordion-body">
                                            <p><strong>Task:</strong> Route planning from {{ shipment_info.origin }} to {{ shipment_info.destination }}</p>
                                            <p><strong>Analysis:</strong></p>
                                            <ul class="mb-2">
                                                <li>Calculated distance and optimal routing</li>
                                                <li>Selected appropriate carrier for {{ shipment_info.fragility }} items</li>
                                                <li>Factored in timeline: {{ shipment_info.timeline or 'Standard delivery' }}</li>
                                            </ul>
                                            <p><strong>Cost Breakdown:</strong></p>
                                            <div class="bg-light p-2 rounded">
                                                <div class="row">
                                                    <div class="col-8">Base Freight Cost:</div>
                                                    <div class="col-4 text-end">$950.00</div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-8">Fuel Surcharge:</div>
                                                    <div class="col-4 text-end">$150.00</div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-8">Fragile Handling Fee:</div>
                                                    <div class="col-4 text-end">$150.00</div>
                                                </div>
                                                <hr class="my-1">
                                                <div class="row fw-bold">
                                                    <div class="col-8">Transportation Total:</div>
                                                    <div class="col-4 text-end">$1,250.00</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Quote Consolidator Agent -->
                                <div class="accordion-item border-0">
                                    <h2 class="accordion-header">
                                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#agent4" aria-expanded="false">
                                            <i class="fas fa-check-circle text-success me-2"></i>
                                            <strong>Quote Consolidation Agent</strong>
                                            <span class="ms-2 text-muted">- Assembled final pricing</span>
                                        </button>
                                    </h2>
                                    <div id="agent4" class="accordion-collapse collapse" data-bs-parent="#agentAccordion">
                                        <div class="accordion-body">
                                            <p><strong>Task:</strong> Consolidated all cost components into comprehensive quote</p>
                                            <p><strong>Additional Services:</strong></p>
                                            <div class="bg-light p-2 rounded">
                                                <div class="row">
                                                    <div class="col-8">Insurance Coverage:</div>
                                                    <div class="col-4 text-end">$75.00</div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-8">Documentation & Permits:</div>
                                                    <div class="col-4 text-end">$50.00</div>
                                                </div>
                                                <hr class="my-1">
                                                <div class="row fw-bold">
                                                    <div class="col-8">Insurance & Documentation:</div>
                                                    <div class="col-4 text-end">$125.00</div>
                                                </div>
                                            </div>
                                            <div class="bg-light p-2 rounded mt-2">
                                                <div class="row">
                                                    <div class="col-8">Loading/Unloading Service:</div>
                                                    <div class="col-4 text-end">$100.00</div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-8">Coordination & Tracking:</div>
                                                    <div class="col-4 text-end">$75.00</div>
                                                </div>
                                                <hr class="my-1">
                                                <div class="row fw-bold">
                                                    <div class="col-8">Special Handling:</div>
                                                    <div class="col-4 text-end">$175.00</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Cost Summary Card -->
                    <div class="card mt-3">
                        <div class="card-header">
                            <h6 class="card-title mb-0">
                                <i class="fas fa-calculator me-2"></i>
                                Cost Calculation Summary
                            </h6>
                        </div>
                        <div class="card-body">
                            <div class="bg-light p-3 rounded">
                                {% if cost_breakdown %}
                                    <div class="row mb-2">
                                        <div class="col-8">Packaging & Crating:</div>
                                        <div class="col-4 text-end">${{ "%.2f"|format(cost_breakdown.packaging_crating) }}</div>
                                    </div>
                                    <div class="row mb-2">
                                        <div class="col-8">Transportation:</div>
                                        <div class="col-4 text-end">${{ "%.2f"|format(cost_breakdown.transportation) }}</div>
                                    </div>
                                    <div class="row mb-2">
                                        <div class="col-8">Insurance & Documentation:</div>
                                        <div class="col-4 text-end">${{ "%.2f"|format(cost_breakdown.insurance_documentation) }}</div>
                                    </div>
                                    <div class="row mb-2">
                                        <div class="col-8">Special Handling:</div>
                                        <div class="col-4 text-end">${{ "%.2f"|format(cost_breakdown.special_handling) }}</div>
                                    </div>
                                    <hr>
                                    <div class="row fw-bold fs-5 text-primary">
                                        <div class="col-8">TOTAL ESTIMATED COST:</div>
                                        <div class="col-4 text-end">${{ "%.2f"|format(cost_breakdown.total) }}</div>
                                    </div>
                                {% else %}
                                    <div class="row mb-2">
                                        <div class="col-8">Packaging & Crating:</div>
                                        <div class="col-4 text-end">$450.00</div>
                                    </div>
                                    <div class="row mb-2">
                                        <div class="col-8">Transportation:</div>
                                        <div class="col-4 text-end">$1,250.00</div>
                                    </div>
                                    <div class="row mb-2">
                                        <div class="col-8">Insurance & Documentation:</div>
                                        <div class="col-4 text-end">$125.00</div>
                                    </div>
                                    <div class="row mb-2">
                                        <div class="col-8">Special Handling:</div>
                                        <div class="col-4 text-end">$175.00</div>
                                    </div>
                                    <hr>
                                    <div class="row fw-bold fs-5 text-primary">
                                        <div class="col-8">TOTAL ESTIMATED COST:</div>
                                        <div class="col-4 text-end">$2,000.00</div>
                                    </div>
                                {% endif %}
                            </div>
                            <small class="text-muted mt-2 d-block">
                                <i class="fas fa-info-circle me-1"></i>
                                All calculations performed by specialized AI agents with real-time cost analysis
                            </small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Display current date and time
        document.addEventListener('DOMContentLoaded', function() {
            const now = new Date();
            document.getElementById('currentDateTime').textContent = now.toLocaleString();
        });

        function downloadQuote() {
            const quoteContent = document.querySelector('.quote-content pre').textContent;
            const blob = new Blob([quoteContent], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'transpak-quote-' + new Date().toISOString().split('T')[0] + '.txt';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }

        function printQuote() {
            window.print();
        }
    </script>
</body>
</html>
